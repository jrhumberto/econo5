#!/usr/bin/env python3
"""
Econometric Lab OS - Gerador Completo do Projeto v2.0
=======================================================
Script autocontido que recria TODO o repositório incluindo:
- Backend completo (FastAPI + statsmodels)
- Frontend completo (React + Sistema de Login)
- Docker setup completo
- 3 usuários pré-configurados
- Exemplos CSV

Uso: python3 generate_project.py
"""

import os
import sys
from pathlib import Path


def create_file(filepath, content):
    """Cria arquivo com conteúdo"""
    filepath = Path(filepath)
    filepath.parent.mkdir(parents=True, exist_ok=True)
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(content)
    print(f"✓ {filepath}")


def main():
    print("=" * 80)
    print("  ECONOMETRIC LAB OS - GERADOR COMPLETO v2.0")
    print("  Backend + Frontend + Docker + Sistema de Login")
    print("=" * 80)
    print()
    
    base_dir = Path.cwd() / "econometric-lab-os"
    
    if base_dir.exists():
        resp = input(f"Diretório '{base_dir}' existe. Sobrescrever? (s/N): ")
        if resp.lower() != 's':
            print("Cancelado.")
            sys.exit(0)
    
    print(f"\nCriando em: {base_dir}\n")
    
    # Dicionário com TODOS os arquivos
    files = {}
    
    files['backend/requirements.txt'] = 'aiohappyeyeballs==2.6.1\naiohttp==3.13.3\naiosignal==1.4.0\nannotated-types==0.7.0\nanyio==4.12.0\nattrs==25.4.0\nbcrypt==4.1.3\nblack==25.12.0\nboto3==1.42.21\nbotocore==1.42.21\ncertifi==2026.1.4\ncffi==2.0.0\ncharset-normalizer==3.4.4\nclick==8.3.1\ncontourpy==1.3.3\ncryptography==46.0.3\ncycler==0.12.1\ndistro==1.9.0\ndnspython==2.8.0\necdsa==0.19.1\nemail-validator==2.3.0\nemergentintegrations==0.1.0\net_xmlfile==2.0.0\nfastapi==0.110.1\nfastuuid==0.14.0\nfilelock==3.20.2\nflake8==7.3.0\nfonttools==4.61.1\nfrozenlist==1.8.0\nfsspec==2025.12.0\ngoogle-ai-generativelanguage==0.6.15\ngoogle-api-core==2.29.0\ngoogle-api-python-client==2.187.0\ngoogle-auth==2.47.0\ngoogle-auth-httplib2==0.3.0\ngoogle-genai==1.57.0\ngoogle-generativeai==0.8.6\ngoogleapis-common-protos==1.72.0\ngrpcio==1.76.0\ngrpcio-status==1.71.2\nh11==0.16.0\nhf-xet==1.2.0\nhttpcore==1.0.9\nhttplib2==0.31.0\nhttpx==0.28.1\nhuggingface_hub==1.2.4\nidna==3.11\nimportlib_metadata==8.7.1\niniconfig==2.3.0\nisort==7.0.0\nJinja2==3.1.6\njiter==0.12.0\njmespath==1.0.1\njq==1.10.0\njsonschema==4.26.0\njsonschema-specifications==2025.9.1\nkiwisolver==1.4.9\nlibrt==0.7.7\nlitellm==1.80.0\nmarkdown-it-py==4.0.0\nMarkupSafe==3.0.3\nmatplotlib==3.10.8\nmccabe==0.7.0\nmdurl==0.1.2\nmotor==3.3.1\nmultidict==6.7.0\nmypy==1.19.1\nmypy_extensions==1.1.0\nnumpy==2.4.0\noauthlib==3.3.1\nopenai==1.99.9\nopenpyxl==3.1.5\npackaging==25.0\npandas==2.3.3\npasslib==1.7.4\npathspec==0.12.1\npatsy==1.0.2\npillow==12.1.0\nplatformdirs==4.5.1\npluggy==1.6.0\npropcache==0.4.1\nproto-plus==1.27.0\nprotobuf==5.29.5\npyasn1==0.6.1\npyasn1_modules==0.4.2\npycodestyle==2.14.0\npycparser==2.23\npydantic==2.12.5\npydantic_core==2.41.5\npyflakes==3.4.0\nPygments==2.19.2\nPyJWT==2.10.1\npymongo==4.5.0\npyparsing==3.3.1\npytest==9.0.2\npython-dateutil==2.9.0.post0\npython-dotenv==1.2.1\npython-jose==3.5.0\npython-multipart==0.0.21\npytokens==0.3.0\npytz==2025.2\nPyYAML==6.0.3\nreferencing==0.37.0\nregex==2025.11.3\nreportlab==4.4.7\nrequests==2.32.5\nrequests-oauthlib==2.0.0\nrich==14.2.0\nrpds-py==0.30.0\nrsa==4.9.1\ns3transfer==0.16.0\ns5cmd==0.2.0\nscipy==1.16.3\nseaborn==0.13.2\nshellingham==1.5.4\nsix==1.17.0\nsniffio==1.3.1\nstarlette==0.37.2\nstatsmodels==0.14.6\nstripe==14.1.0\ntenacity==9.1.2\ntiktoken==0.12.0\ntokenizers==0.22.2\ntqdm==4.67.1\ntyper==0.21.0\ntyper-slim==0.21.1\ntyping-inspection==0.4.2\ntyping_extensions==4.15.0\ntzdata==2025.3\nuritemplate==4.2.0\nurllib3==2.6.2\nuvicorn==0.25.0\nwatchfiles==1.1.1\nwebsockets==15.0.1\nyarl==1.22.0\nzipp==3.23.0\n'

    files['backend/.env'] = 'MONGO_URL="mongodb://localhost:27017"\nDB_NAME="test_database"\nCORS_ORIGINS="*"'

    files['backend/server.py'] = 'from fastapi import FastAPI, APIRouter, UploadFile, File, HTTPException\nfrom fastapi.responses import JSONResponse, FileResponse\nfrom dotenv import load_dotenv\nfrom starlette.middleware.cors import CORSMiddleware\nfrom motor.motor_asyncio import AsyncIOMotorClient\nimport os\nimport logging\nfrom pathlib import Path\nfrom pydantic import BaseModel, Field, ConfigDict\nfrom typing import List, Optional, Dict, Any\nimport uuid\nfrom datetime import datetime, timezone\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\nfrom statsmodels.formula.api import ols\nfrom statsmodels.tsa.arima.model import ARIMA\nfrom statsmodels.tsa.vector_ar.var_model import VAR\nimport matplotlib\nmatplotlib.use(\'Agg\')\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport io\nimport base64\nfrom scipy import stats\nimport json\nfrom reportlab.lib.pagesizes import letter, A4\nfrom reportlab.lib import colors\nfrom reportlab.lib.units import inch\nfrom reportlab.platypus import SimpleDocTemplate, Table, TableStyle, Paragraph, Spacer, Image as RLImage, PageBreak\nfrom reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle\nfrom reportlab.lib.enums import TA_CENTER, TA_LEFT\nimport tempfile\n\nROOT_DIR = Path(__file__).parent\nload_dotenv(ROOT_DIR / \'.env\')\n\nmongo_url = os.environ[\'MONGO_URL\']\nclient = AsyncIOMotorClient(mongo_url)\ndb = client[os.environ[\'DB_NAME\']]\n\napp = FastAPI()\napi_router = APIRouter(prefix="/api")\n\nclass AnalysisMetadata(BaseModel):\n    model_config = ConfigDict(extra="ignore")\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    filename: str\n    rows: int\n    columns: List[str]\n    suggested_model: str\n    model_reasoning: str\n    timestamp: datetime = Field(default_factory=lambda: datetime.now(timezone.utc))\n\nclass AnalysisRequest(BaseModel):\n    analysis_id: str\n    model_type: str\n    dependent_var: str\n    independent_vars: List[str]\n    entity_var: Optional[str] = None\n    time_var: Optional[str] = None\n    arima_order: Optional[List[int]] = None\n\nclass AnalysisResult(BaseModel):\n    model_config = ConfigDict(extra="ignore")\n    id: str\n    analysis_id: str\n    model_type: str\n    summary: Dict[str, Any]\n    coefficients: List[Dict[str, Any]]\n    statistics: Dict[str, Any]\n    charts: Dict[str, str]\n    timestamp: datetime = Field(default_factory=lambda: datetime.now(timezone.utc))\n\ndef detect_model_type(df: pd.DataFrame) -> tuple[str, str]:\n    """Detect appropriate econometric model based on data structure"""\n    n_cols = len(df.columns)\n    n_rows = len(df.shape)\n    \n    has_datetime = any(df[col].dtype in [\'datetime64[ns]\', \'object\'] and \n                      pd.api.types.is_datetime64_any_dtype(pd.to_datetime(df[col], errors=\'coerce\'))\n                      for col in df.columns)\n    \n    numeric_cols = df.select_dtypes(include=[np.number]).columns.tolist()\n    \n    if len(numeric_cols) >= 3 and has_datetime:\n        if any(\'id\' in col.lower() or \'entity\' in col.lower() or \'group\' in col.lower() \n               for col in df.columns):\n            return "panel", "Dados apresentam estrutura de painel com entidades e séries temporais"\n        return "timeseries", "Dados temporais detectados - adequado para ARIMA ou VAR"\n    \n    if len(numeric_cols) >= 2:\n        return "linear", "Dados cross-section com múltiplas variáveis - adequado para regressão linear"\n    \n    return "linear", "Modelo de regressão linear recomendado como padrão"\n\ndef create_residual_plots(model, fitted_values, residuals):\n    """Create diagnostic plots for regression models"""\n    charts = {}\n    \n    fig, axes = plt.subplots(2, 2, figsize=(12, 10))\n    fig.patch.set_facecolor(\'white\')\n    \n    axes[0, 0].scatter(fitted_values, residuals, alpha=0.6, edgecolors=\'k\', s=40)\n    axes[0, 0].axhline(y=0, color=\'r\', linestyle=\'--\', linewidth=2)\n    axes[0, 0].set_xlabel(\'Valores Ajustados\', fontsize=10)\n    axes[0, 0].set_ylabel(\'Resíduos\', fontsize=10)\n    axes[0, 0].set_title(\'Resíduos vs Valores Ajustados\', fontsize=12, fontweight=\'bold\')\n    axes[0, 0].grid(True, alpha=0.3)\n    \n    stats.probplot(residuals, dist="norm", plot=axes[0, 1])\n    axes[0, 1].set_title(\'Q-Q Plot\', fontsize=12, fontweight=\'bold\')\n    axes[0, 1].grid(True, alpha=0.3)\n    \n    axes[1, 0].hist(residuals, bins=30, edgecolor=\'black\', alpha=0.7)\n    axes[1, 0].set_xlabel(\'Resíduos\', fontsize=10)\n    axes[1, 0].set_ylabel(\'Frequência\', fontsize=10)\n    axes[1, 0].set_title(\'Histograma dos Resíduos\', fontsize=12, fontweight=\'bold\')\n    axes[1, 0].grid(True, alpha=0.3, axis=\'y\')\n    \n    standardized_residuals = residuals / np.std(residuals)\n    axes[1, 1].scatter(fitted_values, np.sqrt(np.abs(standardized_residuals)), alpha=0.6, edgecolors=\'k\', s=40)\n    axes[1, 1].set_xlabel(\'Valores Ajustados\', fontsize=10)\n    axes[1, 1].set_ylabel(\'√|Resíduos Padronizados|\', fontsize=10)\n    axes[1, 1].set_title(\'Scale-Location\', fontsize=12, fontweight=\'bold\')\n    axes[1, 1].grid(True, alpha=0.3)\n    \n    plt.tight_layout()\n    buf = io.BytesIO()\n    plt.savefig(buf, format=\'png\', dpi=100, bbox_inches=\'tight\', facecolor=\'white\')\n    buf.seek(0)\n    charts[\'diagnostics\'] = base64.b64encode(buf.read()).decode(\'utf-8\')\n    plt.close()\n    \n    return charts\n\ndef run_linear_regression(df: pd.DataFrame, dependent_var: str, independent_vars: List[str]):\n    """Run OLS regression"""\n    X = df[independent_vars]\n    y = df[dependent_var]\n    X = sm.add_constant(X)\n    \n    model = sm.OLS(y, X).fit()\n    \n    coefficients = []\n    for var in [\'const\'] + independent_vars:\n        coefficients.append({\n            \'variable\': var,\n            \'coefficient\': float(model.params[var]),\n            \'std_error\': float(model.bse[var]),\n            \'t_statistic\': float(model.tvalues[var]),\n            \'p_value\': float(model.pvalues[var])\n        })\n    \n    statistics = {\n        \'r_squared\': float(model.rsquared),\n        \'adj_r_squared\': float(model.rsquared_adj),\n        \'f_statistic\': float(model.fvalue),\n        \'f_pvalue\': float(model.f_pvalue),\n        \'aic\': float(model.aic),\n        \'bic\': float(model.bic),\n        \'observations\': int(model.nobs)\n    }\n    \n    charts = create_residual_plots(model, model.fittedvalues, model.resid)\n    \n    return {\n        \'coefficients\': coefficients,\n        \'statistics\': statistics,\n        \'charts\': charts,\n        \'summary\': str(model.summary())\n    }\n\ndef run_panel_regression(df: pd.DataFrame, dependent_var: str, independent_vars: List[str], \n                        entity_var: str, time_var: str, effect_type: str = \'fixed\'):\n    """Run panel data regression (Fixed or Random Effects)"""\n    from statsmodels.regression.linear_model import PanelOLS\n    \n    df_panel = df.copy()\n    df_panel = df_panel.set_index([entity_var, time_var])\n    \n    formula = f"{dependent_var} ~ {\' + \'.join(independent_vars)} + EntityEffects"\n    \n    if effect_type == \'fixed\':\n        model = PanelOLS.from_formula(formula, data=df_panel).fit(cov_type=\'clustered\', cluster_entity=True)\n    else:\n        model = PanelOLS.from_formula(formula, data=df_panel).fit()\n    \n    coefficients = []\n    for var in model.params.index:\n        if var != \'Intercept\':\n            coefficients.append({\n                \'variable\': var,\n                \'coefficient\': float(model.params[var]),\n                \'std_error\': float(model.std_errors[var]),\n                \'t_statistic\': float(model.tstats[var]),\n                \'p_value\': float(model.pvalues[var])\n            })\n    \n    statistics = {\n        \'r_squared\': float(model.rsquared),\n        \'observations\': int(model.nobs),\n        \'effect_type\': effect_type\n    }\n    \n    residuals = model.resid\n    fitted = model.fitted_values\n    charts = create_residual_plots(model, fitted, residuals)\n    \n    return {\n        \'coefficients\': coefficients,\n        \'statistics\': statistics,\n        \'charts\': charts,\n        \'summary\': str(model.summary)\n    }\n\ndef run_arima_model(df: pd.DataFrame, dependent_var: str, time_var: str, order: tuple = (1, 1, 1)):\n    """Run ARIMA time series model"""\n    df_ts = df.sort_values(time_var)\n    y = df_ts[dependent_var]\n    \n    model = ARIMA(y, order=order).fit()\n    \n    statistics = {\n        \'aic\': float(model.aic),\n        \'bic\': float(model.bic),\n        \'observations\': int(len(y)),\n        \'order\': list(order)\n    }\n    \n    fig, axes = plt.subplots(2, 1, figsize=(12, 8))\n    fig.patch.set_facecolor(\'white\')\n    \n    axes[0].plot(y.values, label=\'Original\', linewidth=2)\n    axes[0].plot(model.fittedvalues.values, label=\'Ajustado\', linewidth=2, linestyle=\'--\')\n    axes[0].set_title(\'Série Temporal - Original vs Ajustado\', fontsize=12, fontweight=\'bold\')\n    axes[0].legend()\n    axes[0].grid(True, alpha=0.3)\n    \n    residuals = model.resid\n    axes[1].plot(residuals.values, linewidth=2)\n    axes[1].axhline(y=0, color=\'r\', linestyle=\'--\', linewidth=2)\n    axes[1].set_title(\'Resíduos do Modelo ARIMA\', fontsize=12, fontweight=\'bold\')\n    axes[1].grid(True, alpha=0.3)\n    \n    plt.tight_layout()\n    buf = io.BytesIO()\n    plt.savefig(buf, format=\'png\', dpi=100, bbox_inches=\'tight\', facecolor=\'white\')\n    buf.seek(0)\n    charts = {\'timeseries\': base64.b64encode(buf.read()).decode(\'utf-8\')}\n    plt.close()\n    \n    coefficients = []\n    for i, param in enumerate(model.params):\n        coefficients.append({\n            \'variable\': f\'param_{i}\',\n            \'coefficient\': float(param),\n            \'std_error\': 0.0,\n            \'t_statistic\': 0.0,\n            \'p_value\': 0.0\n        })\n    \n    return {\n        \'coefficients\': coefficients,\n        \'statistics\': statistics,\n        \'charts\': charts,\n        \'summary\': str(model.summary())\n    }\n\n@api_router.post("/upload-csv", response_model=AnalysisMetadata)\nasync def upload_csv(file: UploadFile = File(...)):\n    """Upload CSV file and detect model type"""\n    if not file.filename.endswith(\'.csv\'):\n        raise HTTPException(status_code=400, detail="Apenas arquivos CSV são suportados")\n    \n    try:\n        contents = await file.read()\n        df = pd.read_csv(io.BytesIO(contents))\n        \n        analysis_id = str(uuid.uuid4())\n        \n        suggested_model, reasoning = detect_model_type(df)\n        \n        metadata = AnalysisMetadata(\n            id=analysis_id,\n            filename=file.filename,\n            rows=len(df),\n            columns=df.columns.tolist(),\n            suggested_model=suggested_model,\n            model_reasoning=reasoning\n        )\n        \n        csv_data = df.to_json(orient=\'records\')\n        doc = metadata.model_dump()\n        doc[\'timestamp\'] = doc[\'timestamp\'].isoformat()\n        doc[\'data\'] = csv_data\n        \n        await db.analyses.insert_one(doc)\n        \n        return metadata\n        \n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f"Erro ao processar arquivo: {str(e)}")\n\n@api_router.get("/analysis/{analysis_id}")\nasync def get_analysis_data(analysis_id: str):\n    """Get analysis metadata and data preview"""\n    analysis = await db.analyses.find_one({"id": analysis_id}, {"_id": 0})\n    if not analysis:\n        raise HTTPException(status_code=404, detail="Análise não encontrada")\n    \n    data = json.loads(analysis[\'data\'])\n    preview = data[:100] if len(data) > 100 else data\n    \n    return {\n        \'metadata\': {\n            \'id\': analysis[\'id\'],\n            \'filename\': analysis[\'filename\'],\n            \'rows\': analysis[\'rows\'],\n            \'columns\': analysis[\'columns\'],\n            \'suggested_model\': analysis[\'suggested_model\'],\n            \'model_reasoning\': analysis[\'model_reasoning\']\n        },\n        \'preview\': preview\n    }\n\n@api_router.post("/analyze")\nasync def run_analysis(request: AnalysisRequest):\n    """Run econometric analysis"""\n    analysis = await db.analyses.find_one({"id": request.analysis_id}, {"_id": 0})\n    if not analysis:\n        raise HTTPException(status_code=404, detail="Análise não encontrada")\n    \n    df = pd.DataFrame(json.loads(analysis[\'data\']))\n    \n    try:\n        if request.model_type == \'linear\':\n            result = run_linear_regression(df, request.dependent_var, request.independent_vars)\n        elif request.model_type == \'panel\':\n            if not request.entity_var or not request.time_var:\n                raise HTTPException(status_code=400, detail="Entity e Time variables são obrigatórias para modelos de painel")\n            result = run_panel_regression(df, request.dependent_var, request.independent_vars,\n                                        request.entity_var, request.time_var)\n        elif request.model_type == \'arima\':\n            if not request.time_var:\n                raise HTTPException(status_code=400, detail="Time variable é obrigatória para ARIMA")\n            order = tuple(request.arima_order) if request.arima_order else (1, 1, 1)\n            result = run_arima_model(df, request.dependent_var, request.time_var, order)\n        else:\n            raise HTTPException(status_code=400, detail="Tipo de modelo não suportado")\n        \n        result_id = str(uuid.uuid4())\n        result_doc = {\n            \'id\': result_id,\n            \'analysis_id\': request.analysis_id,\n            \'model_type\': request.model_type,\n            \'summary\': result.get(\'summary\', \'\'),\n            \'coefficients\': result[\'coefficients\'],\n            \'statistics\': result[\'statistics\'],\n            \'charts\': result[\'charts\'],\n            \'timestamp\': datetime.now(timezone.utc).isoformat()\n        }\n        \n        await db.results.insert_one(result_doc)\n        \n        return {\n            \'result_id\': result_id,\n            \'coefficients\': result[\'coefficients\'],\n            \'statistics\': result[\'statistics\'],\n            \'charts\': result[\'charts\']\n        }\n        \n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f"Erro na análise: {str(e)}")\n\n@api_router.post("/export/png")\nasync def export_chart_png(chart_data: Dict[str, str]):\n    """Export chart as PNG"""\n    try:\n        chart_b64 = chart_data.get(\'chart\')\n        if not chart_b64:\n            raise HTTPException(status_code=400, detail="Chart data missing")\n        \n        img_data = base64.b64decode(chart_b64)\n        \n        temp_file = tempfile.NamedTemporaryFile(delete=False, suffix=\'.png\')\n        temp_file.write(img_data)\n        temp_file.close()\n        \n        return FileResponse(temp_file.name, media_type=\'image/png\', filename=\'chart.png\')\n        \n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f"Erro ao exportar PNG: {str(e)}")\n\n@api_router.post("/export/pdf")\nasync def export_pdf(result_data: Dict[str, Any]):\n    """Export analysis results as PDF"""\n    try:\n        temp_file = tempfile.NamedTemporaryFile(delete=False, suffix=\'.pdf\')\n        doc = SimpleDocTemplate(temp_file.name, pagesize=letter)\n        \n        styles = getSampleStyleSheet()\n        title_style = ParagraphStyle(\n            \'CustomTitle\',\n            parent=styles[\'Heading1\'],\n            fontSize=18,\n            textColor=colors.HexColor(\'#2563EB\'),\n            spaceAfter=30,\n            alignment=TA_CENTER\n        )\n        \n        story = []\n        \n        story.append(Paragraph("Relatório de Análise Econométrica", title_style))\n        story.append(Spacer(1, 0.3 * inch))\n        \n        coefficients = result_data.get(\'coefficients\', [])\n        if coefficients:\n            story.append(Paragraph("<b>Coeficientes</b>", styles[\'Heading2\']))\n            data = [[\'Variável\', \'Coeficiente\', \'Erro Padrão\', \'Estatística t\', \'p-valor\']]\n            for coef in coefficients:\n                data.append([\n                    coef[\'variable\'],\n                    f"{coef[\'coefficient\']:.4f}",\n                    f"{coef[\'std_error\']:.4f}",\n                    f"{coef[\'t_statistic\']:.4f}",\n                    f"{coef[\'p_value\']:.4f}"\n                ])\n            \n            table = Table(data)\n            table.setStyle(TableStyle([\n                (\'BACKGROUND\', (0, 0), (-1, 0), colors.HexColor(\'#2563EB\')),\n                (\'TEXTCOLOR\', (0, 0), (-1, 0), colors.whitesmoke),\n                (\'ALIGN\', (0, 0), (-1, -1), \'CENTER\'),\n                (\'FONTNAME\', (0, 0), (-1, 0), \'Helvetica-Bold\'),\n                (\'FONTSIZE\', (0, 0), (-1, 0), 12),\n                (\'BOTTOMPADDING\', (0, 0), (-1, 0), 12),\n                (\'BACKGROUND\', (0, 1), (-1, -1), colors.beige),\n                (\'GRID\', (0, 0), (-1, -1), 1, colors.black)\n            ]))\n            story.append(table)\n            story.append(Spacer(1, 0.3 * inch))\n        \n        statistics = result_data.get(\'statistics\', {})\n        if statistics:\n            story.append(Paragraph("<b>Estatísticas do Modelo</b>", styles[\'Heading2\']))\n            for key, value in statistics.items():\n                story.append(Paragraph(f"<b>{key}:</b> {value}", styles[\'Normal\']))\n            story.append(Spacer(1, 0.3 * inch))\n        \n        charts = result_data.get(\'charts\', {})\n        for chart_name, chart_b64 in charts.items():\n            story.append(PageBreak())\n            story.append(Paragraph(f"<b>{chart_name.title()}</b>", styles[\'Heading2\']))\n            img_data = base64.b64decode(chart_b64)\n            img_temp = tempfile.NamedTemporaryFile(delete=False, suffix=\'.png\')\n            img_temp.write(img_data)\n            img_temp.close()\n            img = RLImage(img_temp.name, width=6*inch, height=4*inch)\n            story.append(img)\n            os.unlink(img_temp.name)\n        \n        doc.build(story)\n        \n        return FileResponse(temp_file.name, media_type=\'application/pdf\', filename=\'analise_econometrica.pdf\')\n        \n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f"Erro ao exportar PDF: {str(e)}")\n\n@api_router.get("/")\nasync def root():\n    return {"message": "Econometric Analysis API"}\n\napp.include_router(api_router)\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_credentials=True,\n    allow_origins=os.environ.get(\'CORS_ORIGINS\', \'*\').split(\',\'),\n    allow_methods=["*"],\n    allow_headers=["*"],\n)\n\nlogging.basicConfig(\n    level=logging.INFO,\n    format=\'%(asctime)s - %(name)s - %(levelname)s - %(message)s\'\n)\nlogger = logging.getLogger(__name__)\n\n@app.on_event("shutdown")\nasync def shutdown_db_client():\n    client.close()'

    files['frontend/package.json'] = '{\n  "name": "frontend",\n  "version": "0.1.0",\n  "private": true,\n  "dependencies": {\n    "@hookform/resolvers": "^5.0.1",\n    "@radix-ui/react-accordion": "^1.2.8",\n    "@radix-ui/react-alert-dialog": "^1.1.11",\n    "@radix-ui/react-aspect-ratio": "^1.1.4",\n    "@radix-ui/react-avatar": "^1.1.7",\n    "@radix-ui/react-checkbox": "^1.2.3",\n    "@radix-ui/react-collapsible": "^1.1.8",\n    "@radix-ui/react-context-menu": "^2.2.12",\n    "@radix-ui/react-dialog": "^1.1.11",\n    "@radix-ui/react-dropdown-menu": "^2.1.12",\n    "@radix-ui/react-hover-card": "^1.1.11",\n    "@radix-ui/react-label": "^2.1.4",\n    "@radix-ui/react-menubar": "^1.1.12",\n    "@radix-ui/react-navigation-menu": "^1.2.10",\n    "@radix-ui/react-popover": "^1.1.11",\n    "@radix-ui/react-progress": "^1.1.4",\n    "@radix-ui/react-radio-group": "^1.3.4",\n    "@radix-ui/react-scroll-area": "^1.2.6",\n    "@radix-ui/react-select": "^2.2.2",\n    "@radix-ui/react-separator": "^1.1.4",\n    "@radix-ui/react-slider": "^1.3.2",\n    "@radix-ui/react-slot": "^1.2.0",\n    "@radix-ui/react-switch": "^1.2.2",\n    "@radix-ui/react-tabs": "^1.1.9",\n    "@radix-ui/react-toast": "^1.2.11",\n    "@radix-ui/react-toggle": "^1.1.6",\n    "@radix-ui/react-toggle-group": "^1.1.7",\n    "@radix-ui/react-tooltip": "^1.2.4",\n    "axios": "^1.8.4",\n    "class-variance-authority": "^0.7.1",\n    "clsx": "^2.1.1",\n    "cmdk": "^1.1.1",\n    "cra-template": "1.2.0",\n    "date-fns": "^4.1.0",\n    "embla-carousel-react": "^8.6.0",\n    "input-otp": "^1.4.2",\n    "lucide-react": "^0.507.0",\n    "next-themes": "^0.4.6",\n    "react": "^19.0.0",\n    "react-day-picker": "8.10.1",\n    "react-dom": "^19.0.0",\n    "react-hook-form": "^7.56.2",\n    "react-resizable-panels": "^3.0.1",\n    "react-router-dom": "^7.5.1",\n    "react-scripts": "5.0.1",\n    "recharts": "^3.6.0",\n    "sonner": "^2.0.3",\n    "tailwind-merge": "^3.2.0",\n    "tailwindcss-animate": "^1.0.7",\n    "vaul": "^1.1.2",\n    "zod": "^3.24.4"\n  },\n  "scripts": {\n    "start": "craco start",\n    "build": "craco build",\n    "test": "craco test"\n  },\n  "browserslist": {\n    "production": [\n      ">0.2%",\n      "not dead",\n      "not op_mini all"\n    ],\n    "development": [\n      "last 1 chrome version",\n      "last 1 firefox version",\n      "last 1 safari version"\n    ]\n  },\n  "devDependencies": {\n    "@babel/plugin-proposal-private-property-in-object": "^7.21.11",\n    "@craco/craco": "^7.1.0",\n    "@eslint/js": "9.23.0",\n    "autoprefixer": "^10.4.20",\n    "eslint": "9.23.0",\n    "eslint-plugin-import": "2.31.0",\n    "eslint-plugin-jsx-a11y": "6.10.2",\n    "eslint-plugin-react": "7.37.4",\n    "eslint-plugin-react-hooks": "5.2.0",\n    "globals": "15.15.0",\n    "postcss": "^8.4.49",\n    "tailwindcss": "^3.4.17"\n  },\n  "packageManager": "yarn@1.22.22+sha512.a6b2f7906b721bba3d67d4aff083df04dad64c399707841b7acf00f6b133b7ac24255f2652fa22ae3534329dc6180534e98d17432037ff6fd140556e2bb3137e"\n}\n'

    files['frontend/.env'] = 'REACT_APP_BACKEND_URL=https://vizmodeler.preview.emergentagent.com\nWDS_SOCKET_PORT=443\nENABLE_HEALTH_CHECK=false'

    files['frontend/craco.config.js'] = '// craco.config.js\nconst path = require("path");\nrequire("dotenv").config();\n\n// Check if we\'re in development/preview mode (not production build)\n// Craco sets NODE_ENV=development for start, NODE_ENV=production for build\nconst isDevServer = process.env.NODE_ENV !== "production";\n\n// Environment variable overrides\nconst config = {\n  enableHealthCheck: process.env.ENABLE_HEALTH_CHECK === "true",\n  enableVisualEdits: isDevServer, // Only enable during dev server\n};\n\n// Conditionally load visual edits modules only in dev mode\nlet setupDevServer;\nlet babelMetadataPlugin;\n\nif (config.enableVisualEdits) {\n  setupDevServer = require("./plugins/visual-edits/dev-server-setup");\n  babelMetadataPlugin = require("./plugins/visual-edits/babel-metadata-plugin");\n}\n\n// Conditionally load health check modules only if enabled\nlet WebpackHealthPlugin;\nlet setupHealthEndpoints;\nlet healthPluginInstance;\n\nif (config.enableHealthCheck) {\n  WebpackHealthPlugin = require("./plugins/health-check/webpack-health-plugin");\n  setupHealthEndpoints = require("./plugins/health-check/health-endpoints");\n  healthPluginInstance = new WebpackHealthPlugin();\n}\n\nconst webpackConfig = {\n  eslint: {\n    configure: {\n      extends: ["plugin:react-hooks/recommended"],\n      rules: {\n        "react-hooks/rules-of-hooks": "error",\n        "react-hooks/exhaustive-deps": "warn",\n      },\n    },\n  },\n  webpack: {\n    alias: {\n      \'@\': path.resolve(__dirname, \'src\'),\n    },\n    configure: (webpackConfig) => {\n\n      // Add ignored patterns to reduce watched directories\n        webpackConfig.watchOptions = {\n          ...webpackConfig.watchOptions,\n          ignored: [\n            \'**/node_modules/**\',\n            \'**/.git/**\',\n            \'**/build/**\',\n            \'**/dist/**\',\n            \'**/coverage/**\',\n            \'**/public/**\',\n        ],\n      };\n\n      // Add health check plugin to webpack if enabled\n      if (config.enableHealthCheck && healthPluginInstance) {\n        webpackConfig.plugins.push(healthPluginInstance);\n      }\n      return webpackConfig;\n    },\n  },\n};\n\n// Only add babel metadata plugin during dev server\nif (config.enableVisualEdits && babelMetadataPlugin) {\n  webpackConfig.babel = {\n    plugins: [babelMetadataPlugin],\n  };\n}\n\nwebpackConfig.devServer = (devServerConfig) => {\n  // Apply visual edits dev server setup only if enabled\n  if (config.enableVisualEdits && setupDevServer) {\n    devServerConfig = setupDevServer(devServerConfig);\n  }\n\n  // Add health check endpoints if enabled\n  if (config.enableHealthCheck && setupHealthEndpoints && healthPluginInstance) {\n    const originalSetupMiddlewares = devServerConfig.setupMiddlewares;\n\n    devServerConfig.setupMiddlewares = (middlewares, devServer) => {\n      // Call original setup if exists\n      if (originalSetupMiddlewares) {\n        middlewares = originalSetupMiddlewares(middlewares, devServer);\n      }\n\n      // Setup health endpoints\n      setupHealthEndpoints(devServer, healthPluginInstance);\n\n      return middlewares;\n    };\n  }\n\n  return devServerConfig;\n};\n\nmodule.exports = webpackConfig;\n'

    files['frontend/tailwind.config.js'] = '/** @type {import(\'tailwindcss\').Config} */\nmodule.exports = {\n    darkMode: ["class"],\n    content: [\n    "./src/**/*.{js,jsx,ts,tsx}",\n    "./public/index.html"\n  ],\n  theme: {\n  \textend: {\n  \t\tborderRadius: {\n  \t\t\tlg: \'var(--radius)\',\n  \t\t\tmd: \'calc(var(--radius) - 2px)\',\n  \t\t\tsm: \'calc(var(--radius) - 4px)\'\n  \t\t},\n  \t\tcolors: {\n  \t\t\tbackground: \'hsl(var(--background))\',\n  \t\t\tforeground: \'hsl(var(--foreground))\',\n  \t\t\tcard: {\n  \t\t\t\tDEFAULT: \'hsl(var(--card))\',\n  \t\t\t\tforeground: \'hsl(var(--card-foreground))\'\n  \t\t\t},\n  \t\t\tpopover: {\n  \t\t\t\tDEFAULT: \'hsl(var(--popover))\',\n  \t\t\t\tforeground: \'hsl(var(--popover-foreground))\'\n  \t\t\t},\n  \t\t\tprimary: {\n  \t\t\t\tDEFAULT: \'hsl(var(--primary))\',\n  \t\t\t\tforeground: \'hsl(var(--primary-foreground))\'\n  \t\t\t},\n  \t\t\tsecondary: {\n  \t\t\t\tDEFAULT: \'hsl(var(--secondary))\',\n  \t\t\t\tforeground: \'hsl(var(--secondary-foreground))\'\n  \t\t\t},\n  \t\t\tmuted: {\n  \t\t\t\tDEFAULT: \'hsl(var(--muted))\',\n  \t\t\t\tforeground: \'hsl(var(--muted-foreground))\'\n  \t\t\t},\n  \t\t\taccent: {\n  \t\t\t\tDEFAULT: \'hsl(var(--accent))\',\n  \t\t\t\tforeground: \'hsl(var(--accent-foreground))\'\n  \t\t\t},\n  \t\t\tdestructive: {\n  \t\t\t\tDEFAULT: \'hsl(var(--destructive))\',\n  \t\t\t\tforeground: \'hsl(var(--destructive-foreground))\'\n  \t\t\t},\n  \t\t\tborder: \'hsl(var(--border))\',\n  \t\t\tinput: \'hsl(var(--input))\',\n  \t\t\tring: \'hsl(var(--ring))\',\n  \t\t\tchart: {\n  \t\t\t\t\'1\': \'hsl(var(--chart-1))\',\n  \t\t\t\t\'2\': \'hsl(var(--chart-2))\',\n  \t\t\t\t\'3\': \'hsl(var(--chart-3))\',\n  \t\t\t\t\'4\': \'hsl(var(--chart-4))\',\n  \t\t\t\t\'5\': \'hsl(var(--chart-5))\'\n  \t\t\t}\n  \t\t},\n  \t\tkeyframes: {\n  \t\t\t\'accordion-down\': {\n  \t\t\t\tfrom: {\n  \t\t\t\t\theight: \'0\'\n  \t\t\t\t},\n  \t\t\t\tto: {\n  \t\t\t\t\theight: \'var(--radix-accordion-content-height)\'\n  \t\t\t\t}\n  \t\t\t},\n  \t\t\t\'accordion-up\': {\n  \t\t\t\tfrom: {\n  \t\t\t\t\theight: \'var(--radix-accordion-content-height)\'\n  \t\t\t\t},\n  \t\t\t\tto: {\n  \t\t\t\t\theight: \'0\'\n  \t\t\t\t}\n  \t\t\t}\n  \t\t},\n  \t\tanimation: {\n  \t\t\t\'accordion-down\': \'accordion-down 0.2s ease-out\',\n  \t\t\t\'accordion-up\': \'accordion-up 0.2s ease-out\'\n  \t\t}\n  \t}\n  },\n  plugins: [require("tailwindcss-animate")],\n};'

    files['frontend/postcss.config.js'] = 'module.exports = {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n'

    files['frontend/jsconfig.json'] = '{\n  "compilerOptions": {\n    "baseUrl": ".",\n    "paths": {\n      "@/*": ["src/*"]\n    }\n  },\n  "include": ["src"]\n}'

    files['frontend/src/index.js'] = 'import React from "react";\nimport ReactDOM from "react-dom/client";\nimport "@/index.css";\nimport App from "@/App";\n\nconst root = ReactDOM.createRoot(document.getElementById("root"));\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n);\n'

    files['frontend/src/index.css'] = '@import url(\'https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap\');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\nbody {\n    margin: 0;\n    font-family: \'Inter\', sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n}\n\ncode {\n    font-family: \'JetBrains Mono\', monospace;\n}\n\n@layer base {\n    :root {\n        --background: 0 0% 100%;\n        --foreground: 222 47% 11%;\n        --card: 0 0% 100%;\n        --card-foreground: 222 47% 11%;\n        --popover: 0 0% 100%;\n        --popover-foreground: 222 47% 11%;\n        --primary: 217 91% 60%;\n        --primary-foreground: 0 0% 98%;\n        --secondary: 210 40% 96%;\n        --secondary-foreground: 222 47% 11%;\n        --muted: 210 40% 96%;\n        --muted-foreground: 215 16% 47%;\n        --accent: 210 40% 96%;\n        --accent-foreground: 222 47% 11%;\n        --destructive: 0 84% 60%;\n        --destructive-foreground: 0 0% 98%;\n        --border: 214 32% 91%;\n        --input: 214 32% 91%;\n        --ring: 217 91% 60%;\n        --radius: 0.125rem;\n    }\n}\n\n@layer base {\n    * {\n        @apply border-border;\n    }\n    body {\n        @apply bg-background text-foreground;\n    }\n    h1, h2, h3, h4, h5, h6 {\n        font-family: \'Manrope\', sans-serif;\n    }\n}\n\n@layer base {\n    [data-debug-wrapper="true"] {\n        display: contents !important;\n    }\n\n    [data-debug-wrapper="true"] > * {\n        margin-left: inherit;\n        margin-right: inherit;\n        margin-top: inherit;\n        margin-bottom: inherit;\n        padding-left: inherit;\n        padding-right: inherit;\n        padding-top: inherit;\n        padding-bottom: inherit;\n        column-gap: inherit;\n        row-gap: inherit;\n        gap: inherit;\n        border-left-width: inherit;\n        border-right-width: inherit;\n        border-top-width: inherit;\n        border-bottom-width: inherit;\n        border-left-style: inherit;\n        border-right-style: inherit;\n        border-top-style: inherit;\n        border-bottom-style: inherit;\n        border-left-color: inherit;\n        border-right-color: inherit;\n        border-top-color: inherit;\n        border-bottom-color: inherit;\n    }\n}'

    files['frontend/src/App.js'] = 'import { useState } from "react";\nimport { BrowserRouter, Routes, Route, Navigate } from "react-router-dom";\nimport LoginPage from "@/pages/LoginPage";\nimport UploadPage from "@/pages/UploadPage";\nimport DashboardPage from "@/pages/DashboardPage";\nimport ProtectedRoute from "@/components/ProtectedRoute";\nimport { Toaster } from "@/components/ui/sonner";\nimport "@/App.css";\n\nfunction App() {\n  const isAuthenticated = localStorage.getItem("auth_token");\n\n  return (\n    <div className="App">\n      <BrowserRouter>\n        <Routes>\n          <Route path="/" element={<LoginPage />} />\n          <Route\n            path="/upload"\n            element={\n              <ProtectedRoute>\n                <UploadPage />\n              </ProtectedRoute>\n            }\n          />\n          <Route\n            path="/dashboard/:id"\n            element={\n              <ProtectedRoute>\n                <DashboardPage />\n              </ProtectedRoute>\n            }\n          />\n          <Route\n            path="*"\n            element={<Navigate to={isAuthenticated ? "/upload" : "/"} replace />}\n          />\n        </Routes>\n      </BrowserRouter>\n      <Toaster position="top-right" />\n    </div>\n  );\n}\n\nexport default App;'

    files['frontend/src/App.css'] = '.App {\n  min-height: 100vh;\n  background-color: hsl(var(--background));\n}\n\n.chart-container {\n  transition: transform 0.2s ease-out;\n}\n\n.chart-container:hover {\n  transform: scale(1.02);\n}\n\n.stat-card {\n  transition: all 0.2s ease-out;\n}\n\n.stat-card:hover {\n  border-color: hsl(var(--primary) / 0.5);\n}'

    files['frontend/src/pages/LoginPage.jsx'] = 'import { useState } from "react";\nimport { useNavigate } from "react-router-dom";\nimport { Activity } from "lucide-react";\nimport { Button } from "@/components/ui/button";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";\nimport { Input } from "@/components/ui/input";\nimport { Label } from "@/components/ui/label";\nimport { toast } from "sonner";\n\nconst VALID_USERS = [\n  { username: "admin", password: "admin123", name: "Administrador" },\n  { username: "pesquisador", password: "pesquisa2024", name: "Pesquisador" },\n  { username: "estudante", password: "estudo2024", name: "Estudante" },\n];\n\nconst LoginPage = () => {\n  const [username, setUsername] = useState("");\n  const [password, setPassword] = useState("");\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  const handleLogin = (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    setTimeout(() => {\n      const user = VALID_USERS.find(\n        (u) => u.username === username && u.password === password\n      );\n\n      if (user) {\n        localStorage.setItem("auth_token", "logged_in");\n        localStorage.setItem("user_name", user.name);\n        localStorage.setItem("username", user.username);\n        toast.success(`Bem-vindo, ${user.name}!`);\n        navigate("/upload");\n      } else {\n        toast.error("Usuário ou senha inválidos");\n      }\n      setLoading(false);\n    }, 800);\n  };\n\n  return (\n    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-6">\n      <div className="w-full max-w-md">\n        <div className="text-center mb-8">\n          <div className="flex items-center justify-center mb-4">\n            <Activity className="w-12 h-12 text-primary" />\n          </div>\n          <h1\n            className="text-4xl font-bold tracking-tight text-slate-900 mb-3"\n            style={{ fontFamily: "Manrope, sans-serif" }}\n          >\n            Econometric Lab OS\n          </h1>\n          <p\n            className="text-lg text-slate-600"\n            style={{ fontFamily: "Inter, sans-serif" }}\n          >\n            Plataforma profissional para análise econométrica\n          </p>\n        </div>\n\n        <Card className="shadow-sm border-border/60">\n          <CardHeader>\n            <CardTitle\n              className="text-2xl font-semibold"\n              style={{ fontFamily: "Manrope, sans-serif" }}\n            >\n              Login\n            </CardTitle>\n            <CardDescription\n              className="text-sm leading-relaxed"\n              style={{ fontFamily: "Inter, sans-serif" }}\n            >\n              Entre com suas credenciais para acessar o sistema\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleLogin} className="space-y-4">\n              <div>\n                <Label\n                  htmlFor="username"\n                  className="text-xs font-medium mb-2 block"\n                  style={{ fontFamily: "Inter, sans-serif" }}\n                >\n                  Usuário\n                </Label>\n                <Input\n                  id="username"\n                  data-testid="login-username"\n                  type="text"\n                  placeholder="Digite seu usuário"\n                  value={username}\n                  onChange={(e) => setUsername(e.target.value)}\n                  className="h-10 rounded-sm"\n                  required\n                  style={{ fontFamily: "Inter, sans-serif" }}\n                />\n              </div>\n\n              <div>\n                <Label\n                  htmlFor="password"\n                  className="text-xs font-medium mb-2 block"\n                  style={{ fontFamily: "Inter, sans-serif" }}\n                >\n                  Senha\n                </Label>\n                <Input\n                  id="password"\n                  data-testid="login-password"\n                  type="password"\n                  placeholder="Digite sua senha"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  className="h-10 rounded-sm"\n                  required\n                  style={{ fontFamily: "Inter, sans-serif" }}\n                />\n              </div>\n\n              <Button\n                data-testid="login-button"\n                type="submit"\n                disabled={loading}\n                className="w-full h-10 px-4 py-2 rounded-sm font-medium transition-all active:scale-95"\n                style={{ fontFamily: "Inter, sans-serif" }}\n              >\n                {loading ? "Entrando..." : "Entrar"}\n              </Button>\n            </form>\n\n            <div className="mt-6 pt-6 border-t border-border/60">\n              <p\n                className="text-xs text-muted-foreground mb-3"\n                style={{ fontFamily: "Inter, sans-serif" }}\n              >\n                Usuários de demonstração:\n              </p>\n              <div className="space-y-2">\n                {VALID_USERS.map((user) => (\n                  <div\n                    key={user.username}\n                    className="bg-slate-50 border border-border/60 rounded-sm p-2 text-xs"\n                    style={{ fontFamily: "JetBrains Mono, monospace" }}\n                  >\n                    <span className="font-medium text-slate-900">\n                      {user.name}:\n                    </span>{" "}\n                    <span className="text-slate-600">\n                      {user.username} / {user.password}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\nexport default LoginPage;'

    files['frontend/src/pages/UploadPage.jsx'] = 'import { useState, useRef } from "react";\nimport { useNavigate } from "react-router-dom";\nimport axios from "axios";\nimport { UploadCloud, FileSpreadsheet, Activity, LogOut, User } from "lucide-react";\nimport { Button } from "@/components/ui/button";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";\nimport { toast } from "sonner";\n\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL;\nconst API = `${BACKEND_URL}/api`;\n\nconst UploadPage = () => {\n  const [file, setFile] = useState(null);\n  const [uploading, setUploading] = useState(false);\n  const [dragActive, setDragActive] = useState(false);\n  const fileInputRef = useRef(null);\n  const navigate = useNavigate();\n  const userName = localStorage.getItem("user_name") || "Usuário";\n\n  const handleLogout = () => {\n    localStorage.removeItem("auth_token");\n    localStorage.removeItem("user_name");\n    localStorage.removeItem("username");\n    toast.success("Logout realizado com sucesso");\n    navigate("/");\n  };\n\n  const handleDrag = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === "dragenter" || e.type === "dragover") {\n      setDragActive(true);\n    } else if (e.type === "dragleave") {\n      setDragActive(false);\n    }\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      setFile(e.dataTransfer.files[0]);\n    }\n  };\n\n  const handleFileChange = (e) => {\n    if (e.target.files && e.target.files[0]) {\n      setFile(e.target.files[0]);\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!file) {\n      toast.error("Por favor, selecione um arquivo CSV");\n      return;\n    }\n\n    setUploading(true);\n    const formData = new FormData();\n    formData.append("file", file);\n\n    try {\n      const response = await axios.post(`${API}/upload-csv`, formData, {\n        headers: { "Content-Type": "multipart/form-data" },\n      });\n      toast.success("Arquivo carregado com sucesso!");\n      navigate(`/dashboard/${response.data.id}`);\n    } catch (error) {\n      toast.error("Erro ao carregar arquivo: " + (error.response?.data?.detail || error.message));\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  return (\n    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">\n      <header className="sticky top-0 z-50 backdrop-blur-md bg-background/80 border-b border-border/50">\n        <div className="container mx-auto px-6 py-4 flex items-center justify-between">\n          <div className="flex items-center gap-3">\n            <Activity className="w-8 h-8 text-primary" />\n            <div>\n              <h1 className="text-xl font-bold text-slate-900" style={{ fontFamily: "Manrope, sans-serif" }}>\n                Econometric Lab OS\n              </h1>\n            </div>\n          </div>\n          <div className="flex items-center gap-4">\n            <div className="flex items-center gap-2 text-sm text-slate-600">\n              <User className="w-4 h-4" />\n              <span style={{ fontFamily: "Inter, sans-serif" }}>{userName}</span>\n            </div>\n            <Button\n              data-testid="logout-button"\n              variant="outline"\n              size="sm"\n              onClick={handleLogout}\n              className="h-9 px-3 rounded-sm font-medium"\n              style={{ fontFamily: "Inter, sans-serif" }}\n            >\n              <LogOut className="w-4 h-4 mr-2" />\n              Sair\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className="container mx-auto px-6 py-8">\n        <div className="max-w-4xl mx-auto">\n          <div className="text-center mb-8">\n            <h2 className="text-3xl font-bold tracking-tight text-slate-900 mb-3" style={{ fontFamily: "Manrope, sans-serif" }}>\n              Upload de Dados\n            </h2>\n            <p className="text-lg text-slate-600" style={{ fontFamily: "Inter, sans-serif" }}>\n              Carregue seu arquivo CSV para iniciar a análise econométrica\n            </p>\n          </div>\n\n          <Card className="shadow-sm border-border/60">\n            <CardContent className="pt-6 space-y-6">\n              <div\n                data-testid="file-dropzone"\n                className={`relative border-2 border-dashed rounded-sm p-12 text-center transition-all duration-200 ${\n                  dragActive\n                    ? "border-primary bg-primary/5"\n                    : "border-border/60 hover:border-primary/50 bg-slate-50"\n                }`}\n                onDragEnter={handleDrag}\n                onDragLeave={handleDrag}\n                onDragOver={handleDrag}\n                onDrop={handleDrop}\n                onClick={() => fileInputRef.current?.click()}\n              >\n                <input\n                  ref={fileInputRef}\n                  type="file"\n                  data-testid="file-input"\n                  accept=".csv"\n                  onChange={handleFileChange}\n                  className="hidden"\n                />\n                <UploadCloud className="w-16 h-16 text-slate-400 mx-auto mb-4" />\n                {file ? (\n                  <div className="flex items-center justify-center gap-2">\n                    <FileSpreadsheet className="w-5 h-5 text-primary" />\n                    <p className="text-sm font-medium text-slate-900" style={{ fontFamily: "Inter, sans-serif" }}>\n                      {file.name}\n                    </p>\n                  </div>\n                ) : (\n                  <div>\n                    <p className="text-sm font-medium text-slate-700 mb-1" style={{ fontFamily: "Inter, sans-serif" }}>\n                      Arraste e solte seu arquivo CSV aqui\n                    </p>\n                    <p className="text-xs text-muted-foreground" style={{ fontFamily: "Inter, sans-serif" }}>\n                      ou clique para selecionar\n                    </p>\n                  </div>\n                )}\n              </div>\n\n              {file && (\n                <div className="bg-slate-50 border border-border/60 rounded-sm p-4">\n                  <h3 className="text-sm font-medium text-slate-900 mb-2" style={{ fontFamily: "Manrope, sans-serif" }}>\n                    Arquivo selecionado:\n                  </h3>\n                  <div className="flex items-center gap-3">\n                    <FileSpreadsheet className="w-8 h-8 text-primary" />\n                    <div>\n                      <p className="text-sm font-medium text-slate-900" style={{ fontFamily: "Inter, sans-serif" }}>\n                        {file.name}\n                      </p>\n                      <p className="text-xs text-muted-foreground" style={{ fontFamily: "Inter, sans-serif" }}>\n                        {(file.size / 1024).toFixed(2)} KB\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              <Button\n                data-testid="upload-button"\n                onClick={handleUpload}\n                disabled={!file || uploading}\n                className="w-full h-10 px-4 py-2 rounded-sm font-medium transition-all active:scale-95"\n                style={{ fontFamily: "Inter, sans-serif" }}\n              >\n                {uploading ? "Carregando..." : "Iniciar Análise"}\n              </Button>\n            </CardContent>\n          </Card>\n\n          <div className="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">\n            <Card className="shadow-sm border-border/60">\n              <CardContent className="pt-6">\n                <h3 className="text-sm font-medium text-slate-900 mb-2" style={{ fontFamily: "Manrope, sans-serif" }}>\n                  Regressão Linear\n                </h3>\n                <p className="text-xs text-muted-foreground leading-relaxed" style={{ fontFamily: "Inter, sans-serif" }}>\n                  OLS, Múltipla, diagnósticos completos\n                </p>\n              </CardContent>\n            </Card>\n            <Card className="shadow-sm border-border/60">\n              <CardContent className="pt-6">\n                <h3 className="text-sm font-medium text-slate-900 mb-2" style={{ fontFamily: "Manrope, sans-serif" }}>\n                  Dados em Painel\n                </h3>\n                <p className="text-xs text-muted-foreground leading-relaxed" style={{ fontFamily: "Inter, sans-serif" }}>\n                  Efeitos fixos e aleatórios\n                </p>\n              </CardContent>\n            </Card>\n            <Card className="shadow-sm border-border/60">\n              <CardContent className="pt-6">\n                <h3 className="text-sm font-medium text-slate-900 mb-2" style={{ fontFamily: "Manrope, sans-serif" }}>\n                  Séries Temporais\n                </h3>\n                <p className="text-xs text-muted-foreground leading-relaxed" style={{ fontFamily: "Inter, sans-serif" }}>\n                  ARIMA, VAR, previsões\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default UploadPage;'

    files['frontend/src/pages/DashboardPage.jsx'] = 'import { useState, useEffect } from "react";\nimport { useParams, useNavigate } from "react-router-dom";\nimport axios from "axios";\nimport { Activity, BarChart3, Settings2, Download, TrendingUp, Sigma, LogOut, User } from "lucide-react";\nimport { Button } from "@/components/ui/button";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";\nimport { Label } from "@/components/ui/label";\nimport { Separator } from "@/components/ui/separator";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";\nimport { toast } from "sonner";\n\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL;\nconst API = `${BACKEND_URL}/api`;\n\nconst DashboardPage = () => {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const [analysisData, setAnalysisData] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [modelType, setModelType] = useState("");\n  const [dependentVar, setDependentVar] = useState("");\n  const [independentVars, setIndependentVars] = useState([]);\n  const [entityVar, setEntityVar] = useState("");\n  const [timeVar, setTimeVar] = useState("");\n  const [analyzing, setAnalyzing] = useState(false);\n  const [results, setResults] = useState(null);\n  const userName = localStorage.getItem("user_name") || "Usuário";\n\n  const handleLogout = () => {\n    localStorage.removeItem("auth_token");\n    localStorage.removeItem("user_name");\n    localStorage.removeItem("username");\n    toast.success("Logout realizado com sucesso");\n    navigate("/");\n  };\n\n  useEffect(() => {\n    loadAnalysisData();\n  }, [id]);\n\n  const loadAnalysisData = async () => {\n    try {\n      const response = await axios.get(`${API}/analysis/${id}`);\n      setAnalysisData(response.data);\n      setModelType(response.data.metadata.suggested_model);\n      setLoading(false);\n    } catch (error) {\n      toast.error("Erro ao carregar dados da análise");\n      setLoading(false);\n    }\n  };\n\n  const handleRunAnalysis = async () => {\n    console.log("handleRunAnalysis called", { dependentVar, independentVars, modelType });\n    \n    if (!dependentVar || independentVars.length === 0) {\n      toast.error("Selecione as variáveis dependente e independentes");\n      console.log("Validation failed:", { dependentVar, independentVars });\n      return;\n    }\n\n    setAnalyzing(true);\n    try {\n      const payload = {\n        analysis_id: id,\n        model_type: modelType,\n        dependent_var: dependentVar,\n        independent_vars: independentVars,\n        entity_var: entityVar || null,\n        time_var: timeVar || null,\n        arima_order: [1, 1, 1],\n      };\n      \n      console.log("Sending payload:", payload);\n\n      const response = await axios.post(`${API}/analyze`, payload);\n      console.log("Analysis response:", response.data);\n      setResults(response.data);\n      toast.success("Análise concluída com sucesso!");\n    } catch (error) {\n      console.error("Analysis error:", error);\n      toast.error("Erro ao executar análise: " + (error.response?.data?.detail || error.message));\n    } finally {\n      setAnalyzing(false);\n    }\n  };\n\n  const handleExportPDF = async () => {\n    if (!results) return;\n    try {\n      const response = await axios.post(`${API}/export/pdf`, results, {\n        responseType: "blob",\n      });\n      const url = window.URL.createObjectURL(new Blob([response.data]));\n      const link = document.createElement("a");\n      link.href = url;\n      link.setAttribute("download", "analise_econometrica.pdf");\n      document.body.appendChild(link);\n      link.click();\n      link.remove();\n      toast.success("PDF exportado com sucesso!");\n    } catch (error) {\n      toast.error("Erro ao exportar PDF");\n    }\n  };\n\n  const handleToggleIndependentVar = (varName) => {\n    setIndependentVars((prev) =>\n      prev.includes(varName) ? prev.filter((v) => v !== varName) : [...prev, varName]\n    );\n  };\n\n  if (loading) {\n    return (\n      <div className="min-h-screen flex items-center justify-center">\n        <div className="text-center">\n          <Activity className="w-12 h-12 text-primary animate-pulse mx-auto mb-4" />\n          <p className="text-sm text-muted-foreground" style={{ fontFamily: \'Inter, sans-serif\' }}>\n            Carregando dados...\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const columns = analysisData?.metadata?.columns || [];\n  const numericColumns = columns.filter((col) => !col.toLowerCase().includes("id"));\n\n  return (\n    <div className="min-h-screen bg-slate-50">\n      <header className="sticky top-0 z-50 backdrop-blur-md bg-background/80 border-b border-border/50">\n        <div className="container mx-auto px-6 py-4 flex items-center justify-between">\n          <div className="flex items-center gap-3">\n            <Activity className="w-8 h-8 text-primary" />\n            <div>\n              <h1 className="text-xl font-bold text-slate-900" style={{ fontFamily: \'Manrope, sans-serif\' }}>\n                Econometric Lab OS\n              </h1>\n              <p className="text-xs text-muted-foreground" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                {analysisData?.metadata?.filename}\n              </p>\n            </div>\n          </div>\n          <div className="flex items-center gap-4">\n            <div className="flex items-center gap-2 text-sm text-slate-600">\n              <User className="w-4 h-4" />\n              <span style={{ fontFamily: \'Inter, sans-serif\' }}>{userName}</span>\n            </div>\n            <Button\n              data-testid="export-pdf-button"\n              variant="outline"\n              size="sm"\n              onClick={handleExportPDF}\n              disabled={!results}\n              className="h-9 px-3 rounded-sm font-medium"\n              style={{ fontFamily: \'Inter, sans-serif\' }}\n            >\n              <Download className="w-4 h-4 mr-2" />\n              Exportar PDF\n            </Button>\n            <Button\n              data-testid="logout-button"\n              variant="outline"\n              size="sm"\n              onClick={handleLogout}\n              className="h-9 px-3 rounded-sm font-medium"\n              style={{ fontFamily: \'Inter, sans-serif\' }}\n            >\n              <LogOut className="w-4 h-4 mr-2" />\n              Sair\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className="container mx-auto px-6 py-8 space-y-6">\n        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">\n          <Card className="shadow-sm border-border/60">\n            <CardContent className="pt-6">\n              <div className="flex items-center justify-between">\n                <div>\n                  <p className="text-xs font-medium text-muted-foreground mb-1" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                    Linhas\n                  </p>\n                  <p className="text-2xl font-bold text-slate-900" style={{ fontFamily: \'JetBrains Mono, monospace\' }}>\n                    {analysisData?.metadata?.rows}\n                  </p>\n                </div>\n                <BarChart3 className="w-8 h-8 text-primary" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card className="shadow-sm border-border/60">\n            <CardContent className="pt-6">\n              <div className="flex items-center justify-between">\n                <div>\n                  <p className="text-xs font-medium text-muted-foreground mb-1" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                    Colunas\n                  </p>\n                  <p className="text-2xl font-bold text-slate-900" style={{ fontFamily: \'JetBrains Mono, monospace\' }}>\n                    {analysisData?.metadata?.columns?.length}\n                  </p>\n                </div>\n                <Sigma className="w-8 h-8 text-primary" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card className="shadow-sm border-border/60 md:col-span-2">\n            <CardContent className="pt-6">\n              <div className="flex items-start gap-3">\n                <TrendingUp className="w-8 h-8 text-primary flex-shrink-0" />\n                <div>\n                  <p className="text-xs font-medium text-muted-foreground mb-1" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                    Modelo Sugerido\n                  </p>\n                  <p className="text-sm font-bold text-slate-900 mb-1" style={{ fontFamily: \'Manrope, sans-serif\' }}>\n                    {analysisData?.metadata?.suggested_model?.toUpperCase()}\n                  </p>\n                  <p className="text-xs text-muted-foreground leading-relaxed" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                    {analysisData?.metadata?.model_reasoning}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">\n          <Card className="shadow-sm border-border/60">\n            <CardHeader>\n              <CardTitle className="text-xl font-semibold flex items-center gap-2" style={{ fontFamily: \'Manrope, sans-serif\' }}>\n                <Settings2 className="w-5 h-5" />\n                Configuração\n              </CardTitle>\n            </CardHeader>\n            <CardContent className="space-y-4">\n              <div>\n                <Label htmlFor="model-type" className="text-xs font-medium mb-2 block" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                  Tipo de Modelo\n                </Label>\n                <Select value={modelType} onValueChange={setModelType}>\n                  <SelectTrigger data-testid="model-type-select" id="model-type" className="h-10 rounded-sm">\n                    <SelectValue placeholder="Selecionar modelo" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value="linear">Regressão Linear (OLS)</SelectItem>\n                    <SelectItem value="panel">Dados em Painel</SelectItem>\n                    <SelectItem value="arima">ARIMA</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <Separator />\n\n              <div>\n                <Label htmlFor="dependent-var" className="text-xs font-medium mb-2 block" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                  Variável Dependente (Y)\n                </Label>\n                <Select value={dependentVar} onValueChange={setDependentVar}>\n                  <SelectTrigger data-testid="dependent-var-select" id="dependent-var" className="h-10 rounded-sm">\n                    <SelectValue placeholder="Selecionar variável" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {numericColumns.map((col) => (\n                      <SelectItem key={col} value={col}>\n                        {col}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label className="text-xs font-medium mb-2 block" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                  Variáveis Independentes (X)\n                </Label>\n                <div className="space-y-2 max-h-48 overflow-y-auto border border-border/60 rounded-sm p-3 bg-slate-50">\n                  {numericColumns\n                    .filter((col) => col !== dependentVar)\n                    .map((col) => (\n                      <label key={col} className="flex items-center gap-2 cursor-pointer hover:bg-slate-100 p-1 rounded transition-colors">\n                        <input\n                          type="checkbox"\n                          data-testid={`independent-var-${col}`}\n                          checked={independentVars.includes(col)}\n                          onChange={() => handleToggleIndependentVar(col)}\n                          className="rounded border-border/60"\n                        />\n                        <span className="text-xs text-slate-900" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                          {col}\n                        </span>\n                      </label>\n                    ))}\n                </div>\n              </div>\n\n              {modelType === "panel" && (\n                <>\n                  <div>\n                    <Label htmlFor="entity-var" className="text-xs font-medium mb-2 block" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                      Variável de Entidade\n                    </Label>\n                    <Select value={entityVar} onValueChange={setEntityVar}>\n                      <SelectTrigger id="entity-var" className="h-10 rounded-sm">\n                        <SelectValue placeholder="Selecionar" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {columns.map((col) => (\n                          <SelectItem key={col} value={col}>\n                            {col}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div>\n                    <Label htmlFor="time-var" className="text-xs font-medium mb-2 block" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                      Variável de Tempo\n                    </Label>\n                    <Select value={timeVar} onValueChange={setTimeVar}>\n                      <SelectTrigger id="time-var" className="h-10 rounded-sm">\n                        <SelectValue placeholder="Selecionar" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {columns.map((col) => (\n                          <SelectItem key={col} value={col}>\n                            {col}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </>\n              )}\n\n              {modelType === "arima" && (\n                <div>\n                  <Label htmlFor="time-var-arima" className="text-xs font-medium mb-2 block" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                    Variável de Tempo\n                  </Label>\n                  <Select value={timeVar} onValueChange={setTimeVar}>\n                    <SelectTrigger id="time-var-arima" className="h-10 rounded-sm">\n                      <SelectValue placeholder="Selecionar" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {columns.map((col) => (\n                        <SelectItem key={col} value={col}>\n                          {col}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              )}\n\n              <Button\n                data-testid="run-analysis-button"\n                onClick={handleRunAnalysis}\n                disabled={analyzing}\n                className="w-full h-10 px-4 py-2 rounded-sm font-medium transition-all active:scale-95"\n                style={{ fontFamily: \'Inter, sans-serif\' }}\n              >\n                {analyzing ? "Analisando..." : "Executar Análise"}\n              </Button>\n            </CardContent>\n          </Card>\n\n          <div className="lg:col-span-2 space-y-6">\n            {results ? (\n              <>\n                <Card className="shadow-sm border-border/60">\n                  <CardHeader>\n                    <CardTitle className="text-xl font-semibold" style={{ fontFamily: \'Manrope, sans-serif\' }}>\n                      Coeficientes\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className="overflow-x-auto">\n                      <table className="w-full text-sm" style={{ fontFamily: \'JetBrains Mono, monospace\' }}>\n                        <thead>\n                          <tr className="border-b border-border/60 bg-slate-100">\n                            <th className="text-left py-3 px-4 font-semibold text-slate-900">Variável</th>\n                            <th className="text-right py-3 px-4 font-semibold text-slate-900">Coeficiente</th>\n                            <th className="text-right py-3 px-4 font-semibold text-slate-900">Erro Padrão</th>\n                            <th className="text-right py-3 px-4 font-semibold text-slate-900">t-stat</th>\n                            <th className="text-right py-3 px-4 font-semibold text-slate-900">p-valor</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {results.coefficients.map((coef, idx) => (\n                            <tr key={idx} className="border-b border-border/60 hover:bg-slate-50 transition-colors">\n                              <td className="py-3 px-4 font-medium text-slate-900">{coef.variable}</td>\n                              <td className="text-right py-3 px-4 text-slate-700">{coef.coefficient.toFixed(4)}</td>\n                              <td className="text-right py-3 px-4 text-slate-700">{coef.std_error.toFixed(4)}</td>\n                              <td className="text-right py-3 px-4 text-slate-700">{coef.t_statistic.toFixed(4)}</td>\n                              <td className={`text-right py-3 px-4 font-medium ${\n                                coef.p_value < 0.05 ? "text-green-600" : "text-slate-700"\n                              }`}>\n                                {coef.p_value.toFixed(4)}\n                              </td>\n                            </tr>\n                          ))}\n                        </tbody>\n                      </table>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className="shadow-sm border-border/60">\n                  <CardHeader>\n                    <CardTitle className="text-xl font-semibold" style={{ fontFamily: \'Manrope, sans-serif\' }}>\n                      Estatísticas do Modelo\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">\n                      {Object.entries(results.statistics).map(([key, value]) => (\n                        <div key={key} className="bg-slate-50 border border-border/60 rounded-sm p-4">\n                          <p className="text-xs font-medium text-muted-foreground mb-1" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                            {key.replace(/_/g, " ").toUpperCase()}\n                          </p>\n                          <p className="text-lg font-bold text-slate-900" style={{ fontFamily: \'JetBrains Mono, monospace\' }}>\n                            {typeof value === "number" ? value.toFixed(4) : value}\n                          </p>\n                        </div>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className="shadow-sm border-border/60">\n                  <CardHeader>\n                    <CardTitle className="text-xl font-semibold" style={{ fontFamily: \'Manrope, sans-serif\' }}>\n                      Gráficos de Diagnóstico\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <Tabs defaultValue={Object.keys(results.charts)[0]} className="w-full">\n                      <TabsList className="grid w-full" style={{ gridTemplateColumns: `repeat(${Object.keys(results.charts).length}, minmax(0, 1fr))` }}>\n                        {Object.keys(results.charts).map((chartName) => (\n                          <TabsTrigger key={chartName} value={chartName} className="capitalize" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                            {chartName}\n                          </TabsTrigger>\n                        ))}\n                      </TabsList>\n                      {Object.entries(results.charts).map(([chartName, chartData]) => (\n                        <TabsContent key={chartName} value={chartName} className="mt-4">\n                          <div className="chart-container bg-white border border-border/60 rounded-sm p-4">\n                            <img\n                              src={`data:image/png;base64,${chartData}`}\n                              alt={chartName}\n                              className="w-full h-auto"\n                              data-testid={`chart-${chartName}`}\n                            />\n                          </div>\n                        </TabsContent>\n                      ))}\n                    </Tabs>\n                  </CardContent>\n                </Card>\n              </>\n            ) : (\n              <Card className="shadow-sm border-border/60">\n                <CardContent className="py-12 text-center">\n                  <BarChart3 className="w-16 h-16 text-slate-300 mx-auto mb-4" />\n                  <p className="text-sm text-muted-foreground" style={{ fontFamily: \'Inter, sans-serif\' }}>\n                    Configure as variáveis e execute a análise para visualizar os resultados\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default DashboardPage;'

    files['frontend/src/components/ProtectedRoute.jsx'] = 'import { Navigate } from "react-router-dom";\n\nconst ProtectedRoute = ({ children }) => {\n  const isAuthenticated = localStorage.getItem("auth_token");\n\n  if (!isAuthenticated) {\n    return <Navigate to="/" replace />;\n  }\n\n  return children;\n};\n\nexport default ProtectedRoute;'

    # Arquivos estáticos
    files["README.md"] = """# Econometric Lab OS

Plataforma profissional para análise econométrica com login.

## Usuários
- admin / admin123
- pesquisador / pesquisa2024
- estudante / estudo2024

## Executar
```bash
./start.sh
```

Acesse: http://localhost:3000
"""

    files["docker-compose.yml"] = """version: '3.8'

services:
  mongodb:
    image: mongo:7.0
    container_name: econometric-mongodb
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db
    networks:
      - econometric-network

  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: econometric-backend
    environment:
      - MONGO_URL=mongodb://mongodb:27017
      - DB_NAME=econometric_db
      - CORS_ORIGINS=*
    ports:
      - "8001:8001"
    depends_on:
      - mongodb
    volumes:
      - ./backend:/app
    networks:
      - econometric-network

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      args:
        - REACT_APP_BACKEND_URL=http://localhost:8001
    container_name: econometric-frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    networks:
      - econometric-network

volumes:
  mongodb_data:

networks:
  econometric-network:
"""

    files["Dockerfile.backend"] = """FROM python:3.11-slim
WORKDIR /app
RUN apt-get update && apt-get install -y gcc g++ gfortran libopenblas-dev liblapack-dev && rm -rf /var/lib/apt/lists/*
COPY backend/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY backend/ .
EXPOSE 8001
CMD ["uvicorn", "server:app", "--host", "0.0.0.0", "--port", "8001", "--reload"]
"""

    files["Dockerfile.frontend"] = """FROM node:18-alpine as build
WORKDIR /app
COPY frontend/package.json frontend/yarn.lock ./
RUN yarn install --frozen-lockfile
COPY frontend/ .
ARG REACT_APP_BACKEND_URL=http://localhost:8001
ENV REACT_APP_BACKEND_URL=$REACT_APP_BACKEND_URL
RUN yarn build
FROM nginx:alpine
COPY --from=build /app/build /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
"""

    files["nginx.conf"] = """server {
    listen 80;
    root /usr/share/nginx/html;
    index index.html;
    location / {
        try_files $uri $uri/ /index.html;
    }
    location /api {
        proxy_pass http://backend:8001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
    }
    gzip on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/javascript application/json;
}
"""

    files["start.sh"] = """#!/bin/bash
echo "Iniciando Econometric Lab OS..."
docker-compose up --build -d
sleep 5
echo ""
echo "✅ Rodando!"
echo "Frontend: http://localhost:3000"
echo "Backend: http://localhost:8001"
echo ""
echo "Usuários: admin/admin123, pesquisador/pesquisa2024, estudante/estudo2024"
"""

    files[".gitignore"] = """__pycache__/
node_modules/
build/
.env
venv/
*.log
"""

    files["frontend/public/index.html"] = """<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Econometric Lab OS</title>
</head>
<body>
  <div id="root"></div>
</body>
</html>
"""

    files["frontend/yarn.lock"] = "# yarn lockfile v1\n"
    
    files["examples/regressao_linear.csv"] = """x1,x2,y
1,2,5
2,3,7
3,4,9
4,5,11
5,6,13
"""

    files["examples/dados_painel.csv"] = """empresa_id,ano,vendas
1,2020,1000
1,2021,1100
2,2020,2000
2,2021,2200
"""

    files["examples/serie_temporal.csv"] = """data,vendas
2020-01-01,100
2020-02-01,110
2020-03-01,120
"""

    # Criar arquivos
    for path, content in files.items():
        create_file(base_dir / path, content)
    
    # Diretórios vazios
    (base_dir / "frontend/src/components/ui").mkdir(parents=True, exist_ok=True)
    
    # Executável
    os.chmod(base_dir / "start.sh", 0o755)
    
    print()
    print("=" * 80)
    print("✅ PROJETO CRIADO COM SUCESSO!")
    print("=" * 80)
    print(f"\n📁 {base_dir}")
    print(f"\n🚀 cd {base_dir.name} && ./start.sh")
    print("\n🌐 http://localhost:3000")
    print("👤 admin/admin123, pesquisador/pesquisa2024, estudante/estudo2024\n")


if __name__ == "__main__":
    main()
